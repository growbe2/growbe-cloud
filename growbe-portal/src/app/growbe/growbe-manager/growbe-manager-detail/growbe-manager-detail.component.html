<project-dashboard *ngIf="mainboard | async as mainboard$">
    <fuseLayoutHeader>
        <div fxLayout="row" fxLayoutAlign="space-between start">
            <span
                class="mat-display-1 my-0 my-sm-24 welcome-message"
                [@animate]="{ value: '*', params: { x: '50px' } }"
            >
                {{ mainboard$.name }}
            </span>
        </div>
    </fuseLayoutHeader>
    <fuseLayoutContent>
        <mat-tab-group class="ipad" matTabsRouting>
            <mat-tab label="Detail">
                <autoform-form [formData]="detailMainboardForm">
                </autoform-form>
            </mat-tab>
            <mat-tab label="Modules">
                <ng-template #status let-context="context">
                    <app-module-status-dot
                        [moduleId]="context.id"
                    ></app-module-status-dot>
                </ng-template>

                <ng-template #moduleOptions let-context="context">
                    <button
                        mat-stroked-button
                        color="primary"
                        [routerLink]="[
                            '/',
                            'growbe',
                            context.mainboardId,
                            'module',
                            context.id
                        ]"
                    >
                        Dashboard
                    </button>

                    <button
                      mat-stroked-button
                      color="accent"
                      (click)="deleteModule(context.id)"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                </ng-template>

                <ngx-autotable
                    [columns]="
                        moduleColumns
                            | appendArray
                                : [
                                      {
                                          id: 'status',
                                          title: 'Status',
                                          content: {
                                              type: 'template',
                                              content: status
                                          }
                                      },
                                      {
                                          id: 'options',
                                          title: 'Options',
                                          content: {
                                              type: 'template',
                                              content: moduleOptions
                                          }
                                      }
                                  ]
                    "
                    [where]="moduleWhere"
                    [includes]="moduleIncludes"
                    [source]="moduleAPI"
                >
                </ngx-autotable>
            </mat-tab>
            <mat-tab label="Alerts">
                <app-warning-table [growbeId]="id"></app-warning-table>
            </mat-tab>
            <mat-tab label="Action">
              <ngx-autotable [columns]="actionsColumns" [source]="actionsSource"></ngx-autotable>
            </mat-tab>
            <mat-tab label="Stream">
              <app-video-stream-page [growbeId]="id"></app-video-stream-page>
            </mat-tab>
            <mat-tab label="Logs">
                <app-terminal [growbeId]="id"></app-terminal>
            </mat-tab>
        </mat-tab-group>
    </fuseLayoutContent>

    <fuseLayoutSidebar>
        <fuse-widget
            [@animate]="{ value: '*', params: { y: '100%' } }"
            class="pb-0"
        >
            <div class="fuse-widget-front">
                <app-growbe-state [data]="mainboard$"></app-growbe-state>
               
                <div>
                    <app-growbe-local-connection [localConnection]="mainboard$.growbeMainboardConfig.localConnection"></app-growbe-local-connection> 
                </div>
            </div>
        </fuse-widget>
    </fuseLayoutSidebar>
</project-dashboard>
